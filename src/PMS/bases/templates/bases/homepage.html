{% extends 'bases/menu_base.html' %}

{% load crispy_forms_tags %}

{% load staticfiles %}
{% load i18n %}
{% block title %}{% trans "BugList" %}{% endblock %}
{% block css %}
    <style>
        #Wait, #On-Going, #Finished, #pendding { list-style-type: none; margin: 0; float: left; padding: 5px; width: 143px;}
        #Wait div, #On-Going div, #Finished div, #pendding div { margin: 5px; padding: 5px; font-size: 0.95em; width: 120px;}
        .card-body{
            padding: 0px;
            border: thin;
            min-height: 30px;
        }
        .big{
            background-color: #ccf2ff;
        }
        th{
            font-size: 15px;
        }
        td{
            font-size: 14px;
        }
        option{
            font-size: 14px;
        }
    .droptrue{
        width:100%;
        max-height:350px;
        overflow: auto;
    }
    </style>
{% endblock css %}
{% block js %}

    <script>
        $( function() {
            $( "div.droptrue" ).sortable({
                connectWith: "div",
                update: function(event,ui) {
                    $(this).children().each(function () {
                        console.log($(this));
                        if($(this).attr('data-position') != $(this).parent().attr('id')){
                            var new_position={
                                request_no: $(this).attr('data-num'),
                                new_status: $(this).parent().attr('data-code'),
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            };
                            var me = this;
                            $.ajax({
                                type: 'POST',
                                url: 'change_status',
                                data: new_position,
                                dataType:'json',
                                success: function(){
                                    alert('{% trans "DataHasBeenTransfered" %}');
                                    $(me).attr('data-position', $(me).parent().attr('id'));
                                }
                            })

                        }
                    })

                }
            });

            $( "#Wait, #On-Going, #Finished, #pendding" ).disableSelection();
        });
    </script>
{% endblock js %}
{% block breadcrumb %}
    <li class="breadcrumb-item active" aria-current="page">{% trans "home" %}</li>

{% endblock %}
{% block content %}
    <div class="card">
        <div class="card-header" style="background-color: #e0e0e0">
            <div class="row">
                <div class="col-4"><h3>Dashboard</h3></div>
                <div class="col-8 text-right">
                    <a href="{% url "project_manage" pk %}" role="button" data-toggle="tooltip" data-placement="bottom" title="the detail of projects"><i class="far fa-credit-card fa-2x"></i></a>
                </div>
            </div>
        </div>
        <div class="card-body" style="padding: 5px;background-color: #fcfcfc">
            <div class="row">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header big">{% trans "waiting" %}</div>
                        <div class="card-body" id="body1">
                            <div id="Wait" class="droptrue" data-code="1" style="width:100%;">
                                {% for o_request in requests %}
                                    {% if o_request.status.status_en == 'Wait' %}
                                        <div class="card" style="width:97%;background-color: #ffffe6;" data-position="Wait" data-num="{{ o_request.request_no }}">
                                            <div class="card-header" style="width:97%; text-align: left">
                                                <h7 class="card-title"><a href="{% url 'request_detail' pk=o_request.pk %}">{{ o_request.request_no }}</a></h7>
                                            </div>
                                            <div class="card-body" style="width:97%;">
                                                <span>
                                                    {{ o_request.title }}
                                                </span>
                                                <span class="align-bottom" style="float:right">
                                                    {% if o_request.owner.shot %}
                                                        <img src="{{ o_request.owner.shot.url }}" alt="{{ o_request.request_no }}" class="rounded-circle" style="height:35px;width:35px;">
                                                    {% else %}
                                                        <img src="{% static 'base/default_shot.png' %}" alt="{{ o_request.request_no }}" class="rounded-circle" style="height:35px;width:35px;">
                                                    {% endif %}
                                                </span>
                                            </div>

                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header big">{% trans "on_going" %}</div>
                        <div class="card-body">
                            <div id="On-Going" class="droptrue" style="width:100%;" data-code="2">
                                {% for o_request in requests %}
                                    {% if request.status.status_en == 'On-Going' %}
                                        <div class="card" style="width:97%;background-color: #ffffe6;" data-position="On-Going" data-num="{{ o_request.request_no }}">
                                            <div class="card-header" style="width:97%; text-align: left">
                                                <h7 class="card-title"><a href="{% url 'request_detail' pk=o_request.pk %}">{{ o_request.request_no }}</a></h7>
                                            </div>
                                            <div class="card-body" style="width:97%;">
                                                <span>
                                                    {{ o_request.title }}
                                                </span>
                                                <span class="align-bottom" style="float:right">
                                                    {% if o_request.owner.shot %}
                                                        <img src="{{ o_request.owner.shot.url }}" alt="{{ o_request.request_no }}" class="rounded-circle" style="height:35px;width:35px;">
                                                    {% else %}
                                                        <img src="{% static 'base/default_shot.png' %}" alt="{{ o_request.request_no }}" class="rounded-circle" style="height:35px;width:35px;">
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header big">{% trans "finished" %}</div>
                        <div class="card-body">
                            <div id="Finished" class="droptrue" style="width:100%;" data-code="4">
                                {% for o_request in requests %}
                                    {% if o_request.status.status_en == 'Finished' %}
                                        <div class="card" style="width:97%;background-color: #ffffe6;"data-position="Finished" data-num="{{ o_request.request_no }}">
                                            <div class="card-header" style="width:97%; text-align: left">
                                                <h7 class="card-title"><a href="{% url 'request_detail' pk=o_request.pk %}">{{ o_request.request_no }}</a></h7>
                                            </div>
                                            <div class="card-body" style="width:97%;">
                                                <span>
                                                    {{ o_request.title }}
                                                </span>
                                                <span class="align-bottom" style="float:right">
                                                    {% if o_request.owner.shot %}
                                                        <img src="{{ o_request.owner.shot.url }}" alt="{{ o_request.request_no }}" class="rounded-circle" style="height:35px;width:35px;">
                                                    {% else %}
                                                        <img src="{% static 'base/default_shot.png' %}" alt="{{ o_request.request_no }}" class="rounded-circle" style="height:35px;width:35px;">
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header big">{% trans "pending" %}</div>
                        <div class="card-body">
                            <div id="pendding" class="droptrue" style="width:100%;" data-code="5">
                                {% for o_request in requests %}
                                    {% if o_request.status.status_en == 'pendding' %}
                                        <div class="card" style="width:97%;background-color: #ffffe6;" data-position="pendding" data-num="{{ o_request.request_no }}">
                                            <div class="card-header" style="width:97%; text-align: left">
                                                <h7 class="card-title"><a href="{% url 'request_detail' pk=o_request.pk %}">{{ o_request.request_no }}</a></h7>
                                            </div>
                                            <div class="card-body" style="width:97%;">
                                                <span>
                                                    {{ o_request.title }}
                                                </span>
                                                <span class="align-bottom" style="float:right">
                                                    {% if o_request.owner.shot %}
                                                        <img src="{{ o_request.owner.shot.url }}" alt="{{ o_request.request_no }}" class="rounded-circle" style="height:35px;width:35px;">
                                                    {% else %}
                                                        <img src="{% static 'base/default_shot.png' %}" alt="{{ o_request.request_no }}" class="rounded-circle" style="height:35px;width:35px;">
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <br style="clear:both">
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-header" style="background-color: #e0e0e0">
            Project
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover" id="table1">
                <thead>
                    <tr>
                        <th>
                            #
                        </th>
                        <th>
                            {% trans "project_name" %}
                        </th>
                        <th>
                            {% trans "project_code" %}
                        </th>
                        <th>
                            {% trans "project_desc" %}
                        </th>
                        <th>
                            {% trans "create_by" %}
                        </th>
                        <th>
                            {% trans "create_at" %}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for project in projects %}
                    <tr>
                        <td>
                            {{ forloop.counter }}
                        </td>
                        <td>
                            <a href="{% url 'project_manage' project.pk %}">{{ project.name }}</a>
                        </td>
                        <td>
                            {{ project.short_name }}
                        </td>
                        <td>
                            {{ project.desc }}
                        </td>
                        <td>
                            {{ project.create_by }}
                        </td>
                        <td>
                            {{ project.create_at }}
                        </td>

                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>
    </div>
    <div class="card">
        <div class="card-header" style="background-color: #e0e0e0">
            Bug
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover" id="table1">
                <thead>
                    <tr>
                        <th>
                            #
                        </th>
                        <th>
                            {% trans "belong_project" %}
                        </th>
                        <th>
                            {% trans "title" %}
                        </th>
                        <th>
                            {% trans "status" %}
                        </th>
                        <th>
                            {% trans "desc" %}
                        </th>
                        <th>
                            {% trans "owner" %}
                        </th>
                        <th>
                            {% trans "create_by" %}
                        </th>
                        <th>
                            {% trans "create_at" %}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for bug in bugs %}
                    <tr>
                        <td>
                            <a href="{% url 'bug_detail' bug.pk %}">{{ bug.bug_no }}</a>
                        </td>
                        <td>
                            {{ bug.project.name }}
                        </td>
                        <td>
                            {{ bug.title }}
                        </td>
                        <td>
                            {{ bug.status }}
                        </td>
                        <td>
                            {{ bug.level }}
                        </td>
                        <td>
                            {{ bug.owner }}
                        </td>
                        <td>
                            {{ bug.create_by }}
                        </td>
                        <td>
                            {{ bug.create_at }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>
    </div>
    <div class="card">
        <div class="card-header" style="background-color: #e0e0e0">
            Problem
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>
                            #
                        </th>
                        <th>
                            {% trans "belong" %}
                        </th>
                        <th>
                            {% trans "title" %}
                        </th>
                        <th>
                            {% trans "replies" %}
                        </th>
                        <th>
                            {% trans "create_by" %}
                        </th>
                        <th>
                            {% trans "create_at" %}
                        </th>
                        <th>
                            {% trans "update_by" %}
                        </th>
                        <th>
                            {% trans "update_at" %}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for problem in problems %}
                    <tr>
                        <td>
                            <a href="{% url 'problem_detail' problem.pk %}">{{ problem.problem_no }}</a>
                        </td>
                        <td>
                            {{ problem.belong_to }}
                        </td>
                        <td>
                            {{ problem.title }}
                        </td>
                        <td>
                            -
                        </td>
                        <td>
                            {{ problem.create_by }}
                        </td>
                        <td>
                            {{ problem.create_at }}
                        </td>
                        <td>
                            {{ problem.update_by }}
                        </td>
                        <td>
                            {{ problem.update_at }}
                        </td>
                    </tr>
                    {% endfor %}

                </tbody>

            </table>
        </div>
    </div>
{% endblock %}








